<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login - CPA ALEXANDRE</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --bg-main: #070b12;
      --neon-blue: #3b82f6;
      --neon-gold: #facc15;
      --text-main: #e5e7eb;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background:
        radial-gradient(circle at top, rgba(250, 204, 21, 0.06), transparent 40%),
        radial-gradient(circle at bottom, rgba(59, 130, 246, 0.08), transparent 40%),
        var(--bg-main);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      overflow: hidden;
    }

    .login-container {
      background: linear-gradient(160deg, #0b1220, #020617);
      padding: 40px 35px;
      border-radius: 18px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
      border: 1px solid rgba(250, 204, 21, 0.15);
      width: 90%;
      max-width: 400px;
      position: relative;
      overflow: hidden;
    }

    .login-container::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top, rgba(250, 204, 21, 0.12), transparent 45%);
      pointer-events: none;
    }

    .login-content {
      position: relative;
      z-index: 1;
    }

    h1 {
      text-align: center;
      margin-bottom: 30px;
      font-size: 1.8rem;
      color: var(--neon-gold);
      text-shadow: 0 0 12px rgba(250, 204, 21, 0.4);
      letter-spacing: 1px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--text-main);
      letter-spacing: 0.3px;
    }

    input[type="text"],
    input[type="password"] {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid rgba(250, 204, 21, 0.25);
      border-radius: 10px;
      background: #020617;
      color: var(--text-main);
      font-size: 1rem;
      transition: all 0.3s ease;
      box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.8);
    }

    input[type="text"]:focus,
    input[type="password"]:focus {
      outline: none;
      border-color: var(--neon-gold);
      box-shadow: 0 0 12px rgba(250, 204, 21, 0.4), inset 0 0 5px rgba(0, 0, 0, 0.8);
    }

    button {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid rgba(250, 204, 21, 0.25);
      border-radius: 10px;
      background: linear-gradient(145deg, #0b1220, #020617);
      color: var(--text-main);
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 14px rgba(0, 0, 0, 0.7);
      letter-spacing: 0.3px;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(250, 204, 21, 0.25);
      background: linear-gradient(145deg, #facc15, #ca8a04);
      color: #1c1917;
    }

    button:active {
      transform: translateY(0);
    }

    .error {
      color: #ef4444;
      margin-top: 15px;
      text-align: center;
      font-weight: 600;
      display: none;
    }

    .error.show {
      display: block;
    }

    .info {
      text-align: center;
      color: var(--neon-gold);
      margin-top: 20px;
      font-size: 0.9rem;
      opacity: 0.8;
    }

    @media (max-width: 600px) {
      .login-container {
        padding: 30px 20px;
      }

      h1 {
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <div class="login-container">
    <div class="login-content">
      <h1>üìä CPA ALEXANDRE</h1>
      
      <form id="loginForm" onsubmit="handleLogin(event)">
        <div class="form-group">
          <label for="username">Usu√°rio:</label>
          <input type="text" id="username" placeholder="Digite seu usu√°rio" required>
        </div>

        <div class="form-group">
          <label for="password">Senha:</label>
          <input type="password" id="password" placeholder="Digite sua senha" required>
        </div>

        <button type="submit">üîì Entrar</button>
        <button type="button" onclick="abrirCadastro()" style="margin-top:12px;background:linear-gradient(145deg,#064e3b,#022c22);border-color:#10b981;">
  ‚ûï Cadastrar
</button>
      </form>

      <div id="errorMessage" class="error"></div>
    </div>
  </div>

  <script>
    // Verificar se j√° est√° logado
    const user = JSON.parse(localStorage.getItem("user"));
    if (user) {
      window.location.href = "/painel.html";
    }

    async function handleLogin(event) {
  event.preventDefault();

  const usuario = document.getElementById("username").value.trim();
  const senha = document.getElementById("password").value.trim();
  const errorMessage = document.getElementById("errorMessage");

  try {
    const res = await fetch("/login", {
  method:"POST",
  headers:{"Content-Type":"application/json"},
  body: JSON.stringify({ usuario, senha })
});

    const data = await res.json();

    if (!data.ok) {
      errorMessage.textContent = "‚ùå " + data.msg;
      errorMessage.classList.add("show");
      return;
    }

    localStorage.setItem("user", JSON.stringify(data.user));
    window.location.href = "/painel.html";

  } catch {
    errorMessage.textContent = "‚ùå Erro ao conectar no servidor";
    errorMessage.classList.add("show");
  }
}
    function abrirCadastro(){
  document.getElementById("cadastroModal").style.display = "flex";
}

function fecharCadastro(){
  document.getElementById("cadastroModal").style.display = "none";
}

async function salvarCadastro(){
  const usuario = document.getElementById("cadUser").value.trim();
  const senha = document.getElementById("cadPass").value.trim();
  const nivel = document.getElementById("cadNivel").value;

  if(!usuario || !senha){
    alert("Preencha todos os campos");
    return;
  }

  const res = await fetch("/register", {
  method:"POST",
  headers:{"Content-Type":"application/json"},
  body: JSON.stringify({ usuario, senha, nivel })
});

  const data = await res.json();

  if(data.ok){
    alert("‚úÖ Usu√°rio cadastrado!");
    fecharCadastro();
  } else {
    alert("‚ùå " + data.msg);
  }
}


  </script>
  <!-- MODAL CADASTRO -->
<div id="cadastroModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); justify-content:center; align-items:center; z-index:9999;">
  <div style="background:linear-gradient(160deg,#0b1220,#020617); padding:30px; border-radius:16px; width:90%; max-width:420px; border:1px solid rgba(250,204,21,.2); position:relative;">
    <h2 style="text-align:center;color:#facc15;margin-bottom:20px;">‚ûï Criar conta</h2>

    <label>Usu√°rio:</label>
    <input id="cadUser" type="text" style="width:100%;padding:10px;margin-bottom:12px;border-radius:8px;background:#020617;color:white;border:1px solid rgba(250,204,21,.3);">

    <label>Senha:</label>
    <input id="cadPass" type="password" style="width:100%;padding:10px;margin-bottom:12px;border-radius:8px;background:#020617;color:white;border:1px solid rgba(250,204,21,.3);">

    <label>N√≠vel:</label>
    <select id="cadNivel" style="width:100%;padding:10px;margin-bottom:18px;border-radius:8px;background:#020617;color:white;border:1px solid rgba(250,204,21,.3);">
      <option value="cpa">CPA</option>
      <option value="admin">ADMIN</option>
    </select>

    <div style="display:flex;gap:10px;">
      <button onclick="salvarCadastro()" style="flex:1;background:#10b981;">üíæ Cadastrar</button>
      <button onclick="fecharCadastro()" style="flex:1;background:#7f1d1d;">Cancelar</button>
    </div>

    <span onclick="fecharCadastro()" style="position:absolute;top:10px;right:14px;cursor:pointer;">‚úñ</span>
  </div>
</div>

</body>
</html>
